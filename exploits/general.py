"""general config and functions"""
import os
import uuid
from plistlib import readPlist
from subprocess import PIPE, Popen
from xml.parsers.expat import ExpatError

DEFAULT_COMMAND = "python " + os.getcwd() + "/run_as_sudo.py"


def random_string():
    """generates random string"""
    return str(uuid.uuid4())[:8]


def default_browser():
    """gets default browser"""
    try:
        plist = readPlist(os.path.expanduser(
            "~") + "/Library/Preferences/com.apple.LaunchServices/com.apple.launchservices.secure.plist")
    except ExpatError:
        return
    handlers = plist.get("LSHandlers")
    for handler in handlers:
        scheme = handler.get("LSHandlerURLScheme")
        if scheme and scheme == "https":
            return handler.get("LSHandlerRoleAll")
    return


def osascript(command):
    """runs shell for osascript"""
    osa = Popen([command], shell=True, stdout=PIPE)
    response = osa.communicate()[0].strip()
    if isinstance(response, bytes):
        return response.decode("utf-8")
    return response
